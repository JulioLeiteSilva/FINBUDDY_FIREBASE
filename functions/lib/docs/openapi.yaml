openapi: 3.1.0
info:
  title: FinBuddy API
  description: Personal Finance Management API - Monitor your financial life with ease
  version: 1.0.0
  contact:
    name: FinBuddy Support
    email: support@finbuddy.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5001/finbuddy-6af05/southamerica-east1
    description: Local development server
  - url: https://southamerica-east1-finbuddy-6af05.cloudfunctions.net
    description: Production server

tags:
  - name: Authentication
    description: Firebase Authentication endpoints for getting JWT tokens
  - name: User
    description: User management operations
  - name: Bank Account
    description: Bank account management operations
  - name: Transaction
    description: Transaction management operations (Income, Expense, Invoice)
  - name: Credit Card
    description: Credit card management operations
  - name: Credit Card Invoice
    description: Credit card invoice management operations
  - name: Category
    description: User-defined category management operations
  - name: Global Category
    description: Global category management operations

paths:
  /identitytoolkit.googleapis.com/v1/accounts:signInWithPassword:
    post:
      tags:
        - Authentication
      summary: Sign in with email and password
      description: |
        Cria no emulator primeiro e usa aqui pra pegar o JWT é nois

        **Important**: This endpoint is served by Firebase Auth Emulator, not your functions.
        Use this to get a JWT token for testing your API endpoints.
      servers:
        - url: http://localhost:9099
          description: Firebase Auth Emulator
      parameters:
        - name: key
          in: query
          required: true
          schema:
            type: string
            example: "fake-api-key"
          description: "Firebase API key (use 'fake-api-key' for emulator)"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - returnSecureToken
              properties:
                email:
                  type: string
                  format: email
                  example: "fernandoteste@gmail.com"
                  description: "User email address"
                password:
                  type: string
                  example: "senha123"
                  description: "User password"
                returnSecureToken:
                  type: boolean
                  example: true
                  description: "Always set to true to get the JWT token"
            examples:
              login_example:
                summary: Login example
                value:
                  email: "fernandoteste@gmail.com"
                  password: "senha123"
                  returnSecureToken: true
      responses:
        200:
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  idToken:
                    type: string
                    description: "JWT token to use in Authorization header"
                    example: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                  email:
                    type: string
                    example: "fernandoteste@gmail.com"
                  refreshToken:
                    type: string
                    description: "Token for refreshing the idToken"
                  expiresIn:
                    type: string
                    example: "3600"
                  localId:
                    type: string
                    description: "User ID (uid)"
                    example: "user123"
              examples:
                success_response:
                  summary: Successful authentication
                  value:
                    idToken: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZmluYnVkZHktNmFmMDUi..."
                    email: "fernandoteste@gmail.com"
                    refreshToken: "refresh_token_here"
                    expiresIn: "3600"
                    localId: "user123"
        400:
          description: Invalid credentials or request format
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: object
                    properties:
                      code:
                        type: integer
                        example: 400
                      message:
                        type: string
                        example: "INVALID_PASSWORD"

  /user-preRegisterUser:
    post:
      tags:
        - User
      summary: Pre-register a new user
      description: Creates a pre-registered user with basic information from Firebase Auth
      operationId: preRegisterUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - name
                  properties:
                    name:
                      type: string
                      minLength: 2
                      maxLength: 100
                      pattern: '^[a-zA-Z\s]*$'
                      example: "João Silva"
                      description: "User full name (letters and spaces only)"
            examples:
              valid_user:
                summary: Valid user registration
                value:
                  data:
                    name: "Fernando Pereira Martins Junior"
              minimal_user:
                summary: Minimal required data
                value:
                  data:
                    name: "João"
      responses:
        200:
          description: User pre-registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Successful registration
                  value:
                    message: "Usuário pré-registrado com sucesso"
                    data:
                      id: "user123"
                      name: "João Silva"
                      email: "joao@example.com"
                      status: "PENDING"
                      createdAt: "2024-01-15T10:30:00Z"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /user-completeUserProfile:
    post:
      tags:
        - User
      summary: Complete user profile
      description: Completes the user registration with additional required information
      operationId: completeUserProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CompleteUserProfileDTO'
            examples:
              complete_profile:
                summary: Complete profile data
                value:
                  data:
                    cellphone: "11987654321"
                    address: "Rua das Flores, 123, São Paulo, SP"
                    birthDate: "15/03/1990"
                    CPF: "12345678901"
                    financialObjective: "SAVE_MONEY"
      responses:
        200:
          description: User profile completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Profile completed
                  value:
                    message: "Cadastro completo com sucesso"
                    data:
                      id: "user123"
                      name: "João Silva"
                      status: "COMPLETED"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /user-getUser:
    post:
      tags:
        - User
      summary: Get user information
      description: Retrieves the current user's complete profile information
      operationId: getUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
              examples:
                complete_user:
                  summary: Complete user profile
                  value:
                    id: "user123"
                    name: "João Silva"
                    email: "joao@example.com"
                    status: "COMPLETED"
                    createdAt: "2024-01-15T10:30:00Z"
                    cellphone: "11987654321"
                    address: "Rua das Flores, 123, São Paulo, SP"
                    birthDate: "15/03/1990"
                    CPF: "12345678901"
                    financialObjective: "SAVE_MONEY"
                pending_user:
                  summary: Pending user profile
                  value:
                    id: "user456"
                    name: "Maria Santos"
                    email: "maria@example.com"
                    status: "PENDING"
                    createdAt: "2024-01-15T08:00:00Z"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /user-deactivateUser:
    post:
      tags:
        - User
      summary: Deactivate user account
      description: |
        Deactivates the current user's account. This action:
        - Changes user status to DISABLED
        - Sets deactivation timestamp
        - Preserves user data for potential reactivation
      operationId: deactivateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: User account deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Account deactivated
                  value:
                    message: "Usuário desativado com sucesso"
                    data:
                      id: "user123"
                      status: "DISABLED"
                      deactivatedAt: "2024-01-15T15:30:00Z"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-createBankAccount:
    post:
      tags:
        - Bank Account
      summary: Create a new bank account
      description: Creates a new bank account for the authenticated user
      operationId: createBankAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CreateBankAccountDTO'
            examples:
              savings_account:
                summary: Savings account example
                value:
                  data:
                    name: "Conta Poupança Santander"
                    type: "SAVINGS"
                    bank: "Santander"
                    balance: 1500.50
                    currency: "BRL"
              checking_account:
                summary: Checking account example
                value:
                  data:
                    name: "Conta Corrente Itaú"
                    type: "CHECKING"
                    bank: "Itaú"
                    balance: 2500.00
                    currency: "BRL"
      responses:
        200:
          description: Bank account created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Account created
                  value:
                    message: "Conta bancária criada com sucesso"
                    data:
                      id: "account123"
                      name: "Conta Poupança Santander"
                      type: "SAVINGS"
                      bank: "Santander"
                      balance: 1500.50
                      currency: "BRL"
                      createdAt: "2024-01-15T10:30:00Z"
                      updatedAt: "2024-01-15T10:30:00Z"
                      isActive: true
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-updateBankAccount:
    post:
      tags:
        - Bank Account
      summary: Update bank account
      description: Updates an existing bank account
      operationId: updateBankAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  allOf:
                    - type: object
                      required:
                        - id
                      properties:
                        id:
                          type: string
                          description: "Bank account ID"
                          example: "account123"
                    - $ref: '#/components/schemas/UpdateBankAccountDTO'
            examples:
              update_name:
                summary: Update account name
                value:
                  data:
                    id: "account123"
                    name: "Nova Conta Poupança"
              update_balance:
                summary: Update balance
                value:
                  data:
                    id: "account123"
                    balance: 3000.00
      responses:
        200:
          description: Bank account updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-updateBankAccountBalance:
    post:
      tags:
        - Bank Account
      summary: Update bank account balance
      description: Updates only the balance of a bank account (used for transaction adjustments)
      operationId: updateBankAccountBalance
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                    - balance
                  properties:
                    id:
                      type: string
                      description: "Bank account ID"
                      example: "account123"
                    balance:
                      type: number
                      description: "New account balance"
                      example: 2750.50
            examples:
              update_balance:
                summary: Update balance
                value:
                  data:
                    id: "account123"
                    balance: 2750.50
      responses:
        200:
          description: Account balance updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-deleteBankAccount:
    post:
      tags:
        - Bank Account
      summary: Delete bank account
      description: Deletes a bank account (only if it has no linked transactions)
      operationId: deleteBankAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Bank account ID to delete"
                      example: "account123"
            examples:
              delete_account:
                summary: Delete account
                value:
                  data:
                    id: "account123"
      responses:
        200:
          description: Bank account deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Account deleted
                  value:
                    message: "Conta bancária excluída com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-getBankAccount:
    post:
      tags:
        - Bank Account
      summary: Get bank account
      description: Retrieves a specific bank account by ID
      operationId: getBankAccount
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Bank account ID"
                      example: "account123"
            examples:
              get_account:
                summary: Get account by ID
                value:
                  data:
                    id: "account123"
      responses:
        200:
          description: Bank account retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BankAccount'
              examples:
                success:
                  summary: Account retrieved
                  value:
                    data:
                      id: "account123"
                      name: "Conta Poupança Santander"
                      type: "SAVINGS"
                      bank: "Santander"
                      balance: 1500.50
                      currency: "BRL"
                      createdAt: "2024-01-15T10:30:00Z"
                      updatedAt: "2024-01-15T10:30:00Z"
                      isActive: true
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-getAllBankAccounts:
    post:
      tags:
        - Bank Account
      summary: Get all bank accounts
      description: Retrieves all bank accounts for the authenticated user
      operationId: getAllBankAccounts
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Bank accounts retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          accounts:
                            type: array
                            items:
                              $ref: '#/components/schemas/BankAccount'
              examples:
                success:
                  summary: Accounts retrieved
                  value:
                    message: "Listagem de contas efetuada com sucesso!"
                    data:
                      accounts:
                        - id: "account123"
                          name: "Conta Poupança Santander"
                          type: "SAVINGS"
                          bank: "Santander"
                          balance: 1500.50
                          currency: "BRL"
                          createdAt: "2024-01-15T10:30:00Z"
                          updatedAt: "2024-01-15T10:30:00Z"
                          isActive: true
                        - id: "account456"
                          name: "Conta Corrente Itaú"
                          type: "CHECKING"
                          bank: "Itaú"
                          balance: 2500.00
                          currency: "BRL"
                          createdAt: "2024-01-15T08:00:00Z"
                          updatedAt: "2024-01-15T08:00:00Z"
                          isActive: true
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /bank-getBalancesByMonth:
    post:
      tags:
        - Bank Account
      summary: Get bank account balances by month
      description: |
        Retrieves bank account balances with different calculations based on the requested month:
        
        **Current Month:**
        - Returns current balance and forecast balance for each account
        - Forecast includes unpaid transactions for the current month
        - Provides total balance and forecast total balance
        
        **Past Months:**
        - Returns monthly net balance (paid incomes - paid expenses) for each account
        - Provides past month total balance
        
        **Future Months:**
        - Only supports next month forecast
        - Returns forecast balance based on recurring transactions
        - Provides forecast total balance
      operationId: getBankAccountBalancesByMonth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/BankAccountBalancesByMonthRequestDTO'
            examples:
              current_month:
                summary: Get current month balances
                value:
                  data:
                    month: "2025-08"
              past_month:
                summary: Get past month balances
                value:
                  data:
                    month: "2025-07"
              next_month:
                summary: Get next month forecast
                value:
                  data:
                    month: "2025-09"
      responses:
        200:
          description: Bank account balances retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BankAccountBalancesByMonthResponseDTO'
              examples:
                current_month_response:
                  summary: Current month balances
                  value:
                    message: "Listagem de contas efetuada com sucesso!"
                    data:
                      accounts:
                        - id: "account123"
                          name: "Conta Corrente Nubank"
                          type: "CHECKING"
                          bank: "260"
                          balance: 1500.00
                          currency: "BRL"
                          forecastBankAccountBalance: 2200.50
                        - id: "account456"
                          name: "Conta Corrente Itaú"
                          type: "CHECKING"
                          bank: "341"
                          balance: 3000.00
                          currency: "BRL"
                          forecastBankAccountBalance: 2800.00
                      totalBalance: 4500.00
                      forecastTotalBalance: 5000.50
                past_month_response:
                  summary: Past month balances
                  value:
                    message: "Listagem de contas efetuada com sucesso!"
                    data:
                      accounts:
                        - id: "account123"
                          name: "Conta Corrente Nubank"
                          type: "CHECKING"
                          bank: "260"
                          balance: 1500.00
                          currency: "BRL"
                          pastMonthBankAccountBalance: 800.00
                        - id: "account456"
                          name: "Conta Corrente Itaú"
                          type: "CHECKING"
                          bank: "341"
                          balance: 3000.00
                          currency: "BRL"
                          pastMonthBankAccountBalance: -200.00
                      pastMonthTotalBalance: 600.00
                future_month_response:
                  summary: Next month forecast
                  value:
                    message: "Listagem de contas efetuada com sucesso!"
                    data:
                      accounts:
                        - id: "account123"
                          name: "Conta Corrente Nubank"
                          type: "CHECKING"
                          bank: "260"
                          balance: 1500.00
                          currency: "BRL"
                          forecastBankAccountBalance: 1950.00
                        - id: "account456"
                          name: "Conta Corrente Itaú"
                          type: "CHECKING"
                          bank: "341"
                          balance: 3000.00
                          currency: "BRL"
                          forecastBankAccountBalance: 2750.00
                      forecastTotalBalance: 4700.00
        400:
          description: Validation errors or invalid month
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_month_format:
                  summary: Invalid month format
                  value:
                    error: "Validation failed: [{\"field\":\"month\",\"message\":\"Month must be in YYYY-MM format\"}]"
                invalid_date:
                  summary: Invalid date
                  value:
                    error: "Validation failed: [{\"field\":\"month\",\"message\":\"Invalid month format\"}]"
                future_month_not_supported:
                  summary: Future month beyond next month
                  value:
                    error: "Forecast is only available for the next month"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-createIncomeOrExpense:
    post:
      tags:
        - Transaction
      summary: Create income or expense transaction
      description: Creates a new income or expense transaction (non-invoice)
      operationId: createIncomeOrExpense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/TransactionRequestDTO'
            examples:
              income_transaction:
                summary: Income transaction example
                value:
                  data:
                    name: "Salário Janeiro"
                    category: "Salário"
                    value: 5000.00
                    date: "2024-01-15"
                    type: "INCOME"
                    isRecurring: false
                    isPaid: true
                    currency: "BRL"
                    bankAccountId: "account123"
              expense_transaction:
                summary: Expense transaction example
                value:
                  data:
                    name: "Supermercado"
                    category: "Alimentação"
                    value: 250.75
                    date: "2024-01-15"
                    type: "EXPENSE"
                    isRecurring: false
                    isPaid: true
                    currency: "BRL"
                    bankAccountId: "account123"
              recurring_expense:
                summary: Recurring expense example
                value:
                  data:
                    name: "Aluguel"
                    category: "Moradia"
                    value: 1200.00
                    date: "2024-01-01"
                    type: "EXPENSE"
                    isRecurring: true
                    frequency: "MONTHLY"
                    startDate: "2024-01-01"
                    endDate: "2024-12-01"
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
      responses:
        200:
          description: Transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Transaction created
                  value:
                    message: "Transação criada com sucesso"
                    data:
                      id: "transaction123"
                      name: "Salário Janeiro"
                      category: "Salário"
                      value: 5000.00
                      date: "2024-01-15T00:00:00Z"
                      type: "INCOME"
                      isRecurring: false
                      isPaid: true
                      currency: "BRL"
                      bankAccountId: "account123"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-getAllIncomeOrExpense:
    post:
      tags:
        - Transaction
      summary: Get all income and expense transactions
      description: Retrieves all income and expense transactions for the authenticated user (excludes invoices)
      operationId: getAllIncomeOrExpense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Transactions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          transactions:
                            type: array
                            items:
                              $ref: '#/components/schemas/Transaction'
              examples:
                success:
                  summary: Transactions retrieved
                  value:
                    message: "Transações recuperadas com sucesso"
                    data:
                      transactions:
                        - id: "transaction123"
                          name: "Salário Janeiro"
                          category: "Salário"
                          value: 5000.00
                          date: "2024-01-15T00:00:00Z"
                          type: "INCOME"
                          isRecurring: false
                          isPaid: true
                          currency: "BRL"
                          bankAccountId: "account123"
                          primaryTransactionId: null
                        - id: "transaction456"
                          name: "Supermercado"
                          category: "Alimentação"
                          value: 250.75
                          date: "2024-01-15T00:00:00Z"
                          type: "EXPENSE"
                          isRecurring: false
                          isPaid: true
                          currency: "BRL"
                          bankAccountId: "account123"
                          primaryTransactionId: null
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-deleteIncomeOrExpenseTransaction:
    post:
      tags:
        - Transaction
      summary: Delete income or expense transaction
      description: Deletes a specific income or expense transaction by ID
      operationId: deleteIncomeOrExpenseTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Transaction ID to delete"
                      example: "transaction123"
            examples:
              delete_transaction:
                summary: Delete transaction
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Transaction deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Transaction deleted
                  value:
                    message: "Transação excluída com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  # GENERAL TRANSACTION OPERATIONS
  /transaction-updateTransaction:
    post:
      tags:
        - Transaction
      summary: Update transaction
      description: Updates any existing transaction (income, expense, or invoice)
      operationId: updateTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  allOf:
                    - type: object
                      required:
                        - id
                      properties:
                        id:
                          type: string
                          description: "Transaction ID to update"
                          example: "transaction123"
                    - $ref: '#/components/schemas/TransactionRequestDTO'
            examples:
              update_transaction_value:
                summary: Update transaction value
                value:
                  data:
                    id: "transaction123"
                    name: "Salário Janeiro Atualizado"
                    category: "Salário"
                    value: 5500.00
                    date: "2024-01-15"
                    type: "INCOME"
                    isRecurring: false
                    isPaid: true
                    currency: "BRL"
                    bankAccountId: "account123"
              update_recurring_transaction:
                summary: Update recurring transaction
                value:
                  data:
                    id: "transaction456"
                    name: "Aluguel Novo Valor"
                    category: "Moradia"
                    value: 1300.00
                    date: "2024-01-01"
                    type: "EXPENSE"
                    isRecurring: true
                    frequency: "MONTHLY"
                    startDate: "2024-01-01"
                    endDate: "2024-12-01"
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
      responses:
        200:
          description: Transaction updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Transaction updated
                  value:
                    message: "Transação atualizada com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  # RECURRING TRANSACTION OPERATIONS
  /transaction-deleteRecurringTransaction:
    post:
      tags:
        - Transaction
      summary: Delete recurring transaction
      description: Deletes a recurring transaction and all its related instances
      operationId: deleteRecurringTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Recurring transaction ID to delete"
                      example: "transaction123"
            examples:
              delete_recurring:
                summary: Delete recurring transaction
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Recurring transaction deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Recurring transaction deleted
                  value:
                    message: "Transação recorrente excluída com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-updateRecurringTransactionGroup:
    post:
      tags:
        - Transaction
      summary: Update recurring transaction group
      description: Updates all transactions in a recurring transaction group
      operationId: updateRecurringTransactionGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  allOf:
                    - type: object
                      required:
                        - id
                      properties:
                        id:
                          type: string
                          description: "Primary transaction ID of the recurring group"
                          example: "transaction123"
                    - $ref: '#/components/schemas/PartialTransactionRequestDTO'
            examples:
              update_recurring_group_value:
                summary: Update recurring group value
                value:
                  data:
                    id: "transaction123"
                    value: 1400.00
                    name: "Aluguel Reajustado"
              update_recurring_group_frequency:
                summary: Update recurring group frequency
                value:
                  data:
                    id: "transaction123"
                    frequency: "WEEKLY"
                    endDate: "2024-06-01"
      responses:
        200:
          description: Recurring transaction group updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Recurring group updated
                  value:
                    message: "Grupo de transações recorrentes atualizado com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-markRecurringTransactionAsPaid:
    post:
      tags:
        - Transaction
      summary: Mark recurring transaction as paid
      description: Marks a specific recurring transaction instance as paid
      operationId: markRecurringTransactionAsPaid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Recurring transaction ID to mark as paid"
                      example: "transaction123"
            examples:
              mark_as_paid:
                summary: Mark transaction as paid
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Recurring transaction marked as paid successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Transaction marked as paid
                  value:
                    message: "Transação recorrente marcada como paga"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-markRecurringTransactionAsUnpaid:
    post:
      tags:
        - Transaction
      summary: Mark recurring transaction as unpaid
      description: Marks a specific recurring transaction instance as unpaid
      operationId: markRecurringTransactionAsUnpaid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Recurring transaction ID to mark as unpaid"
                      example: "transaction123"
            examples:
              mark_as_unpaid:
                summary: Mark transaction as unpaid
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Recurring transaction marked as unpaid successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Transaction marked as unpaid
                  value:
                    message: "Transação recorrente marcada como não paga"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-createInvoice:
    post:
      tags:
        - Transaction
      summary: Create invoice transaction
      description: |
        Creates a new invoice transaction (credit card purchase).
        
        **Credit Limit Behavior:**
        - Immediately reserves credit from the card's available limit
        - For installments, reserves the full series amount upfront
        - Adds transaction value to the appropriate invoice total
        - Validates that available credit is sufficient before creation
        
        **Installment Handling:**
        - Creates multiple transactions across different invoice periods
        - Each installment is linked via primaryTransactionId
        - Full installment series credit is reserved immediately
      operationId: createInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/TransactionRequestDTO'
            examples:
              single_invoice:
                summary: Single invoice transaction
                value:
                  data:
                    name: "Compra Amazon"
                    category: "Compras Online"
                    value: 299.90
                    date: "2024-01-15"
                    type: "INVOICE"
                    invoiceId: "invoice123"
                    creditCardId: "card123"
                    isRecurring: false
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
              recurring_invoice:
                summary: Recurring invoice (subscription)
                value:
                  data:
                    name: "Netflix Subscription"
                    category: "Entretenimento"
                    value: 45.90
                    date: "2024-01-01"
                    type: "INVOICE"
                    invoiceId: "invoice456"
                    creditCardId: "card123"
                    isRecurring: true
                    frequency: "MONTHLY"
                    startDate: "2024-01-01"
                    endDate: "2024-12-01"
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
              installment_invoice:
                summary: Installment purchase
                value:
                  data:
                    name: "Smartphone - Parcela 1/12"
                    category: "Eletrônicos"
                    value: 166.67
                    date: "2024-01-15"
                    type: "INVOICE"
                    invoiceId: "invoice789"
                    creditCardId: "card123"
                    isRecurring: true
                    frequency: "MONTHLY"
                    startDate: "2024-01-15"
                    endDate: "2024-12-15"
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
      responses:
        200:
          description: Invoice transaction created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice created
                  value:
                    message: "Transação de fatura criada com sucesso"
                    data:
                      id: "transaction123"
                      name: "Compra Amazon"
                      category: "Compras Online"
                      value: 299.90
                      date: "2024-01-15T00:00:00Z"
                      type: "INVOICE"
                      invoiceId: "invoice123"
                      creditCardId: "card123"
                      isRecurring: false
                      isPaid: false
                      currency: "BRL"
                      bankAccountId: "account123"
        400:
          description: Validation errors
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                limit_decrease_blocked:  # 🆕 NEW EXAMPLE
                  summary: Cannot decrease limit below used amount
                  value:
                    error: "New limit would be exceeded by existing transactions. Used: 3000.00, New Limit: 2500.00"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-getAllInvoices:
    post:
      tags:
        - Transaction
      summary: Get all invoice transactions
      description: Retrieves all invoice transactions for the authenticated user
      operationId: getAllInvoices
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Invoice transactions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            items:
                              $ref: '#/components/schemas/Transaction'
              examples:
                success:
                  summary: Invoices retrieved
                  value:
                    message: "Faturas recuperadas com sucesso"
                    data:
                      invoices:
                        - id: "transaction123"
                          name: "Compra Amazon"
                          category: "Compras Online"
                          value: 299.90
                          date: "2024-01-15T00:00:00Z"
                          type: "INVOICE"
                          invoiceId: "invoice123"
                          creditCardId: "card123"
                          isRecurring: false
                          isPaid: false
                          currency: "BRL"
                          bankAccountId: "account123"
                          primaryTransactionId: null
                        - id: "transaction456"
                          name: "Netflix Subscription"
                          category: "Entretenimento"
                          value: 45.90
                          date: "2024-01-15T00:00:00Z"
                          type: "INVOICE"
                          invoiceId: "invoice456"
                          creditCardId: "card123"
                          isRecurring: true
                          frequency: "MONTHLY"
                          isPaid: false
                          currency: "BRL"
                          bankAccountId: "account123"
                          primaryTransactionId: "transaction456"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-deleteInvoiceTransaction:
    post:
      tags:
        - Transaction
      summary: Delete invoice transaction
      description: Deletes a specific invoice transaction by ID
      operationId: deleteInvoiceTransaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Invoice transaction ID to delete"
                      example: "transaction123"
            examples:
              delete_invoice:
                summary: Delete invoice transaction
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Invoice transaction deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice deleted
                  value:
                    message: "Transação de fatura excluída com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-updateInvoiceTransactions:
    post:
      tags:
        - Transaction
      summary: Update invoice transactions
      description: Updates invoice transactions (typically used for batch updates or invoice adjustments)
      operationId: updateInvoiceTransactions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/TransactionRequestDTO'
            examples:
              update_invoice_value:
                summary: Update invoice transaction
                value:
                  data:
                    name: "Compra Amazon - Valor Corrigido"
                    category: "Compras Online"
                    value: 349.90
                    date: "2024-01-15"
                    type: "INVOICE"
                    invoiceId: "invoice123"
                    creditCardId: "card123"
                    isRecurring: false
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
              update_recurring_invoice:
                summary: Update recurring invoice
                value:
                  data:
                    name: "Netflix Premium"
                    category: "Entretenimento"
                    value: 55.90
                    date: "2024-01-01"
                    type: "INVOICE"
                    invoiceId: "invoice456"
                    creditCardId: "card123"
                    isRecurring: true
                    frequency: "MONTHLY"
                    startDate: "2024-01-01"
                    endDate: "2024-12-01"
                    isPaid: false
                    currency: "BRL"
                    bankAccountId: "account123"
      responses:
        200:
          description: Invoice transactions updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice updated
                  value:
                    message: "Transações de fatura atualizadas com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /transaction-payInvoiceInstallment:
    post:
      tags:
        - Transaction
      summary: Pay invoice installment
      description: Marks a specific invoice installment as paid and processes the payment
      operationId: payInvoiceInstallment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Invoice installment transaction ID to pay"
                      example: "transaction123"
            examples:
              pay_installment:
                summary: Pay invoice installment
                value:
                  data:
                    id: "transaction123"
      responses:
        200:
          description: Invoice installment paid successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Installment paid
                  value:
                    message: "Parcela da fatura paga com sucesso"
                    data:
                      transactionId: "transaction123"
                      paidAt: "2024-01-15T14:30:00Z"
                      remainingInstallments: 11
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCard-create:
    post:
      tags:
        - Credit Card
      summary: Create credit card
      description: Creates a new credit card linked to a bank account
      operationId: createCreditCard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CreditCardRequestDTO'
            examples:
              visa_card:
                summary: Visa credit card
                value:
                  data:
                    name: "Cartão Visa Santander"
                    flag: "VISA"
                    closingDay: 15
                    dueDate: 10
                    limit: 5000.00
                    bankAccountId: "account123"
              mastercard_example:
                summary: Mastercard example
                value:
                  data:
                    name: "Mastercard Itaú"
                    flag: "MASTERCARD"
                    closingDay: 5
                    dueDate: 25
                    limit: 3000.00
                    bankAccountId: "account456"
              amex_card:
                summary: American Express card
                value:
                  data:
                    name: "Amex Gold"
                    flag: "AMEX"
                    closingDay: 20
                    dueDate: 15
                    limit: 10000.00
                    bankAccountId: "account789"
      responses:
        200:
          description: Credit card created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Card created
                  value:
                    message: "Cartão criado com sucesso"
                    data:
                      id: "card123"
                      name: "Cartão Visa Santander"
                      flag: "VISA"
                      closingDay: 15
                      dueDate: 10
                      usedLimit: 0.00
                      limit: 5000.00
                      bankAccountId: "account123"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCard-update:
    post:
      tags:
        - Credit Card
      summary: Update credit card
      description: Updates an existing credit card. Limit changes will affect open invoices.
      operationId: updateCreditCard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  allOf:
                    - type: object
                      required:
                        - id
                      properties:
                        id:
                          type: string
                          description: "Credit card ID to update"
                          example: "card123"
                    - $ref: '#/components/schemas/UpdateCreditCardDTO'
            examples:
              update_limit:
                summary: Update card limit
                value:
                  data:
                    id: "card123"
                    limit: 7500.00
              update_name_and_dates:
                summary: Update name and billing dates
                value:
                  data:
                    id: "card123"
                    name: "Cartão Visa Premium"
                    closingDay: 20
                    dueDate: 15
              update_bank_account:
                summary: Change linked bank account
                value:
                  data:
                    id: "card123"
                    bankAccountId: "account456"
      responses:
        200:
          description: Credit card updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Card updated
                  value:
                    message: "Cartão atualizado com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCard-delete:
    post:
      tags:
        - Credit Card
      summary: Delete credit card
      description: Deletes a credit card. Only allowed if all invoices have total equal to card limit (no transactions).
      operationId: deleteCreditCard
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Credit card ID to delete"
                      example: "card123"
            examples:
              delete_card:
                summary: Delete credit card
                value:
                  data:
                    id: "card123"
      responses:
        200:
          description: Credit card deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Card deleted
                  value:
                    message: "Cartão excluído com sucesso"
        400:
          description: Cannot delete card with transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                has_transactions:
                  summary: Card has transactions
                  value:
                    error: "Não é possível excluir o cartão: existe fatura com total diferente do limite do cartão"
                    details: "Fatura 01/2024"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCard-getAll:
    post:
      tags:
        - Credit Card
      summary: Get all credit cards
      description: Retrieves all credit cards for the authenticated user
      operationId: getAllCreditCards
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Credit cards retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/CreditCard'
              examples:
                success:
                  summary: Cards retrieved
                  value:
                    message: "Cartões recuperados com sucesso"
                    data:
                      - id: "card123"
                        name: "Cartão Visa Santander"
                        flag: "VISA"
                        closingDay: 15
                        dueDate: 10
                        limit: 5000.00
                        usedLimit: 1250.50
                        bankAccountId: "account123"
                      - id: "card456"
                        name: "Mastercard Itaú"
                        flag: "MASTERCARD"
                        closingDay: 5
                        dueDate: 25
                        limit: 3000.00
                        usedLimit: 1250.50
                        bankAccountId: "account456"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCardInvoice-create:
    post:
      tags:
        - Credit Card Invoice
      summary: Create credit card invoice
      description: Creates a new invoice for a specific credit card
      operationId: createCreditCardInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - cardId
                    - invoice
                  properties:
                    cardId:
                      type: string
                      description: "Credit card ID"
                      example: "card123"
                    invoice:
                      $ref: '#/components/schemas/CreditCardInvoice'
            examples:
              create_january_invoice:
                summary: Create January invoice
                value:
                  data:
                    cardId: "card123"
                    invoice:
                      id: "invoice123"
                      status: "OPEN"
                      total: 0
                      month: 1
                      year: 2024
                      bankAccountId: null
              create_closed_invoice:
                summary: Create closed invoice
                value:
                  data:
                    cardId: "card456"
                    invoice:
                      id: "invoice456"
                      status: "CLOSED"
                      total: 2500.75
                      month: 12
                      year: 2023
                      bankAccountId: null
      responses:
        200:
          description: Credit card invoice created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice created
                  value:
                    message: "Fatura criada com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCardInvoice-update:
    post:
      tags:
        - Credit Card Invoice
      summary: Update credit card invoice
      description: Updates an existing invoice. Cannot update paid invoices.
      operationId: updateCreditCardInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - cardId
                    - invoiceId
                    - data
                  properties:
                    cardId:
                      type: string
                      description: "Credit card ID"
                      example: "card123"
                    invoiceId:
                      type: string
                      description: "Invoice ID to update"
                      example: "invoice123"
                    data:
                      $ref: '#/components/schemas/UpdateCreditCardInvoiceDTO'
            examples:
              update_total:
                summary: Update invoice total
                value:
                  data:
                    cardId: "card123"
                    invoiceId: "invoice123"
                    data:
                      total: 3500.50
              close_invoice:
                summary: Close invoice
                value:
                  data:
                    cardId: "card123"
                    invoiceId: "invoice123"
                    data:
                      status: "CLOSED"
              update_month_year:
                summary: Update invoice period
                value:
                  data:
                    cardId: "card123"
                    invoiceId: "invoice123"
                    data:
                      month: 2
                      year: 2024
      responses:
        200:
          description: Credit card invoice updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice updated
                  value:
                    message: "Fatura atualizada com sucesso"
        400:
          description: Cannot edit paid invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                paid_invoice:
                  summary: Cannot edit paid invoice
                  value:
                    error: "Não é possível editar uma fatura já paga."
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCardInvoice-delete:
    post:
      tags:
        - Credit Card Invoice
      summary: Delete credit card invoice
      description: Deletes a specific credit card invoice
      operationId: deleteCreditCardInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - cardId
                    - invoiceId
                  properties:
                    cardId:
                      type: string
                      description: "Credit card ID"
                      example: "card123"
                    invoiceId:
                      type: string
                      description: "Invoice ID to delete"
                      example: "invoice123"
            examples:
              delete_invoice:
                summary: Delete invoice
                value:
                  data:
                    cardId: "card123"
                    invoiceId: "invoice123"
      responses:
        200:
          description: Credit card invoice deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice deleted
                  value:
                    message: "Fatura excluída com sucesso"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCardInvoice-getAll:
    post:
      tags:
        - Credit Card Invoice
      summary: Get all credit card invoices
      description: Retrieves all invoices for a specific credit card
      operationId: getAllCreditCardInvoices
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - cardId
                  properties:
                    cardId:
                      type: string
                      description: "Credit card ID"
                      example: "card123"
            examples:
              get_all_invoices:
                summary: Get all invoices for card
                value:
                  data:
                    cardId: "card123"
      responses:
        200:
          description: Credit card invoices retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          invoices:
                            type: array
                            items:
                              $ref: '#/components/schemas/CreditCardInvoice'
              examples:
                success:
                  summary: Invoices retrieved
                  value:
                    message: "Faturas recuperadas com sucesso"
                    data:
                      invoices:
                        - id: "invoice123"
                          status: "OPEN"
                          total: 3500.50
                          month: 1
                          year: 2024
                          bankAccountId: null
                        - id: "invoice456"
                          status: "PAID"
                          total: 2500.75
                          month: 12
                          year: 2023
                          bankAccountId: "account123"
                        - id: "invoice789"
                          status: "CLOSED"
                          total: 4200.00
                          month: 11
                          year: 2023
                          bankAccountId: null
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /creditCardInvoice-payInvoice:
    post:
      tags:
        - Credit Card Invoice
      summary: Pay credit card invoice
      description: |
        Pays a closed credit card invoice. This will:
        - Mark the invoice as PAID
        - Mark all related transactions as paid
        - Release reserved credit back to the card's available limit
        - Create an expense transaction equal to the invoice total
        - Link the payment to a bank account
        
        **Credit Limit Impact:**
        - Paying an invoice releases the reserved credit
        - Available limit increases by the invoice total amount
      operationId: payCreditCardInvoice
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - cardId
                    - invoiceId
                    - bankAccountId
                  properties:
                    cardId:
                      type: string
                      description: "Credit card ID"
                      example: "card123"
                    invoiceId:
                      type: string
                      description: "Invoice ID to pay"
                      example: "invoice123"
                    bankAccountId:
                      type: string
                      description: "Bank account ID to debit the payment from"
                      example: "account123"
            examples:
              pay_invoice:
                summary: Pay invoice
                value:
                  data:
                    cardId: "card123"
                    invoiceId: "invoice123"
                    bankAccountId: "account123"
      responses:
        200:
          description: Credit card invoice paid successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Invoice paid
                  value:
                    message: "Fatura paga com sucesso"
                    data:
                      invoiceId: "invoice123"
                      paidAt: "2024-01-15T14:30:00Z"
                      paymentTransactionId: "transaction789"
                      bankAccountId: "account123"
        400:
          description: Cannot pay open invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                open_invoice:
                  summary: Cannot pay open invoice
                  value:
                    error: "Só é possível pagar faturas fechadas."
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /category-createCategory:
    post:
      tags:
        - Category
      summary: Create a new category
      description: Creates a new user-defined category
      operationId: createCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CategoryRequestDTO'
            examples:
              create_category:
                summary: Create category example
                value:
                  data:
                    name: "Alimentação"
                    type: "EXPENSE"
                    icon: "food"
      responses:
        200:
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Category created
                  value:
                    message: "Categoria criada com sucesso"
                    data:
                      id: "category123"
                      name: "Alimentação"
                      type: "EXPENSE"
                      icon: "food"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /category-updateCategory:
    post:
      tags:
        - Category
      summary: Update category
      description: Updates an existing user-defined category
      operationId: updateCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  allOf:
                    - type: object
                      required:
                        - id
                      properties:
                        id:
                          type: string
                          description: "Category ID to update"
                          example: "category123"
                    - $ref: '#/components/schemas/CategoryRequestDTO'
            examples:
              update_category:
                summary: Update category example
                value:
                  data:
                    id: "category123"
                    name: "Alimentação e Bebidas"
                    type: "EXPENSE"
                    icon: "food"
      responses:
        200:
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Category updated
                  value:
                    message: "Categoria atualizada com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /category-deleteCategory:
    post:
      tags:
        - Category
      summary: Delete category
      description: Deletes a user-defined category
      operationId: deleteCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Category ID to delete"
                      example: "category123"
            examples:
              delete_category:
                summary: Delete category example
                value:
                  data:
                    id: "category123"
      responses:
        200:
          description: Category deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Category deleted
                  value:
                    message: "Categoria excluída com sucesso"
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /category-getCategory:
    post:
      tags:
        - Category
      summary: Get category
      description: Retrieves a specific user-defined category by ID
      operationId: getCategory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  required:
                    - id
                  properties:
                    id:
                      type: string
                      description: "Category ID"
                      example: "category123"
            examples:
              get_category:
                summary: Get category example
                value:
                  data:
                    id: "category123"
      responses:
        200:
          description: Category retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Category'
              examples:
                success:
                  summary: Category retrieved
                  value:
                    data:
                      id: "category123"
                      name: "Alimentação"
                      type: "EXPENSE"
                      icon: "food"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /category-getAllCategories:
    post:
      tags:
        - Category
      summary: Get all categories
      description: Retrieves all user-defined categories for the authenticated user
      operationId: getAllCategories
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  type: object
                  description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Category'
              examples:
                success:
                  summary: Categories retrieved
                  value:
                    message: "Categorias recuperadas com sucesso"
                    data:
                      - id: "category123"
                        name: "Alimentação"
                        type: "EXPENSE"
                        icon: "food"
                      - id: "category456"
                        name: "Transporte"
                        type: "EXPENSE"
                        icon: "car"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /globalCategory-seedCategoriesDefaults:
    post:
      tags:
        - Global Category
      summary: Seed default categories
      description: Seeds the database with default global categories
      operationId: seedCategoriesDefaults
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Default categories seeded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
              examples:
                success:
                  summary: Categories seeded
                  value:
                    message: "Categorias padrão criadas com sucesso"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /globalCategory-getAllDefaultCategories:
    post:
      tags:
        - Global Category
      summary: Get all default categories
      description: Retrieves all default global categories
      operationId: getAllDefaultCategories
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: "Empty data object required for Firebase Functions"
            examples:
              empty_request:
                summary: Empty data request
                value:
                  data: {}
      responses:
        200:
          description: Default categories retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Category'
              examples:
                success:
                  summary: Default categories retrieved
                  value:
                    message: "Categorias padrão recuperadas com sucesso"
                    data:
                      - id: "globalCategory123"
                        name: "Alimentação"
                        type: "EXPENSE"
                        icon: "food"
                      - id: "globalCategory456"
                        name: "Transporte"
                        type: "EXPENSE"
                        icon: "car"
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /financialPlanning-create:
    post:
      tags:
        - Financial Planning
      summary: Create financial plan
      description: Creates a new financial plan for a specific month
      operationId: createFinancialPlanning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CreateFinancialPlanningRequestDTO'
      responses:
        200:
          description: Financial plan created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FinancialPlanningWithCategories'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /financialPlanning-copyFromMonth:
    post:
      tags:
        - Financial Planning
      summary: Copy financial plan from month
      description: Creates a new financial plan by copying from a previous month
      operationId: copyFinancialPlanningFromMonth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/CopyFinancialPlanningRequestDTO'
      responses:
        200:
          description: Financial plan copied successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FinancialPlanningWithCategories'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /financialPlanning-getByMonth:
    post:
      tags:
        - Financial Planning
      summary: Get financial plan by month
      description: Retrieves a financial plan with spending progress for a specific month
      operationId: getFinancialPlanningByMonth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/GetFinancialPlanningRequestDTO'
      responses:
        200:
          description: Financial plan retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FinancialPlanningWithCategories'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /financialPlanning-update:
    post:
      tags:
        - Financial Planning
      summary: Update financial plan
      description: Updates an existing financial plan
      operationId: updateFinancialPlanning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/UpdateFinancialPlanningRequestDTO'
      responses:
        200:
          description: Financial plan updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/FinancialPlanningWithCategories'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

  /financialPlanning-delete:
    post:
      tags:
        - Financial Planning
      summary: Delete financial plan
      description: Deletes a financial plan
      operationId: deleteFinancialPlanning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - data
              properties:
                data:
                  $ref: '#/components/schemas/DeleteFinancialPlanningRequestDTO'
      responses:
        200:
          description: Financial plan deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        400:
          $ref: '#/components/responses/ValidationError'
        401:
          $ref: '#/components/responses/UnauthorizedError'
        404:
          $ref: '#/components/responses/NotFoundError'
        500:
          $ref: '#/components/responses/InternalServerError'
      security:
        - FirebaseAuth: []

components:
  schemas:
    CompleteUserProfileDTO:
      type: object
      required:
        - cellphone
        - address
        - birthDate
        - CPF
        - financialObjective
      properties:
        cellphone:
          type: string
          minLength: 10
          maxLength: 11
          pattern: '^\d+$'
          example: "11987654321"
          description: "Phone number (10-11 digits, numbers only)"
        address:
          type: string
          minLength: 5
          maxLength: 200
          example: "Rua das Flores, 123, São Paulo, SP"
          description: "Complete address"
        birthDate:
          type: string
          pattern: '^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$'
          example: "15/03/1990"
          description: "Birth date in DD/MM/YYYY format"
        CPF:
          type: string
          minLength: 11
          maxLength: 11
          pattern: '^\d+$'
          example: "12345678901"
          description: "Brazilian CPF (11 digits, numbers only)"
        financialObjective:
          $ref: '#/components/schemas/FinancialObjective'

    UserResponse:
      type: object
      properties:
        id:
          type: string
          example: "user123"
          description: "Unique user identifier"
        name:
          type: string
          example: "João Silva"
          description: "User's full name"
        email:
          type: string
          format: email
          example: "joao@example.com"
          description: "User's email address"
        status:
          $ref: '#/components/schemas/UserStatus'
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: "Account creation timestamp"
        cellphone:
          type: string
          example: "11987654321"
          description: "User's phone number (only present if profile is completed)"
        address:
          type: string
          example: "Rua das Flores, 123, São Paulo, SP"
          description: "User's address (only present if profile is completed)"
        birthDate:
          type: string
          example: "15/03/1990"
          description: "User's birth date (only present if profile is completed)"
        CPF:
          type: string
          example: "12345678901"
          description: "User's CPF (only present if profile is completed)"
        financialObjective:
          $ref: '#/components/schemas/FinancialObjective'

    UserStatus:
      type: string
      enum:
        - PENDING
        - COMPLETED
        - DISABLED
      example: "COMPLETED"
      description: |
        Current status of the user account:
        - PENDING: User registered but profile not completed
        - COMPLETED: Full profile completed, can use all features
        - DISABLED: Account deactivated

    FinancialObjective:
      type: string
      enum:
        - SAVE_MONEY
        - PAY_OFF_DEBT
        - INVEST
        - CONTROL_SPENDING
        - RETIREMENT
        - TRAVEL
        - EMERGENCY_FUND
      example: "SAVE_MONEY"
      description: |
        User's primary financial objective:
        - SAVE_MONEY: Juntar dinheiro
        - PAY_OFF_DEBT: Quitar dívidas
        - INVEST: Investir
        - CONTROL_SPENDING: Controlar os gastos
        - RETIREMENT: Aposentadoria
        - TRAVEL: Viagem
        - EMERGENCY_FUND: Montar fundo de emergência

    AccountType:
      type: string
      enum:
        - CHECKING
        - SAVINGS
        - INVESTMENT
        - CREDIT
      example: "CHECKING"
      description: "Type of bank account"

    BankAccount:
      type: object
      properties:
        id:
          type: string
          example: "account123"
          description: "Unique account identifier"
        name:
          type: string
          example: "Conta Poupança Santander"
          description: "Account display name"
        type:
          $ref: '#/components/schemas/AccountType'
        bank:
          type: string
          example: "Santander"
          description: "Bank name"
        balance:
          type: number
          example: 1500.50
          description: "Current account balance"
        currency:
          type: string
          example: "BRL"
          description: "Currency code (ISO 4217)"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: "Account creation timestamp"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
          description: "Last update timestamp"
        isActive:
          type: boolean
          example: true
          description: "Whether the account is active"

    CreateBankAccountDTO:
      type: object
      required:
        - name
        - type
        - bank
        - balance
        - currency
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 50
          example: "Conta Poupança Santander"
          description: "Account display name (3-50 characters)"
        type:
          $ref: '#/components/schemas/AccountType'
        bank:
          type: string
          minLength: 2
          maxLength: 50
          example: "Santander"
          description: "Bank name (2-50 characters)"
        balance:
          type: number
          example: 1500.50
          description: "Initial account balance (must be finite)"
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: "BRL"
          description: "Currency code (ISO 4217 format)"

    UpdateBankAccountDTO:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 50
          example: "Nova Conta Poupança"
          description: "Account display name (3-50 characters)"
        type:
          $ref: '#/components/schemas/AccountType'
        bank:
          type: string
          minLength: 2
          maxLength: 50
          example: "Santander"
          description: "Bank name (2-50 characters)"
        balance:
          type: number
          example: 2000.00
          description: "Account balance (must be finite)"
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: "BRL"
          description: "Currency code (ISO 4217 format)"

    BankAccountBalancesByMonthRequestDTO:
      type: object
      required:
        - month
      properties:
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: "2024-01"
          description: "Month in YYYY-MM format"
      example:
        month: "2024-01"

    BankAccountWithBalances:
      allOf:
        - $ref: '#/components/schemas/BankAccount'
        - type: object
          properties:
            forecastBankAccountBalance:
              type: number
              example: 2200.50
              description: "Forecast balance for current/future months (current balance + unpaid/recurring transactions)"
              nullable: true
            pastMonthBankAccountBalance:
              type: number
              example: 800.00
              description: "Monthly net balance for past months (paid incomes - paid expenses)"
              nullable: true

    BankAccountBalancesByMonthResponseDTO:
      type: object
      required:
        - message
        - accounts
      properties:
        message:
          type: string
          example: "Listagem de contas efetuada com sucesso!"
          description: "Success message"
        accounts:
          type: array
          items:
            $ref: '#/components/schemas/BankAccountWithBalances'
          description: "List of bank accounts with balance information"
        totalBalance:
          type: number
          example: 4500.00
          description: "Total current balance across all accounts (current month only)"
          nullable: true
        forecastTotalBalance:
          type: number
          example: 5000.50
          description: "Total forecast balance across all accounts (current/future months only)"
          nullable: true
        pastMonthTotalBalance:
          type: number
          example: 600.00
          description: "Total monthly net balance across all accounts (past months only)"
          nullable: true

    TransactionType:
      type: string
      enum:
        - INCOME
        - EXPENSE
        - INVOICE
      example: "INCOME"
      description: "Type of transaction"

    TransactionFrequency:
      type: string
      enum:
        - DAILY
        - WEEKLY
        - MONTHLY
        - YEARLY
      example: "MONTHLY"
      description: "Frequency for recurring transactions"

    TransactionRequestDTO:
      type: object
      required:
        - name
        - category
        - value
        - date
        - type
        - currency
        - bankAccountId
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: "Salário Janeiro"
          description: "Transaction name (3-100 characters)"
        category:
          type: string
          minLength: 2
          maxLength: 30
          example: "Salário"
          description: "Transaction category (2-30 characters)"
        value:
          type: number
          example: 1500.50
          description: "Transaction value (must be finite)"
        date:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-01-15"
          description: "Transaction date (YYYY-MM-DD or ISO format)"
        type:
          $ref: '#/components/schemas/TransactionType'
        invoiceId:
          type: string
          example: "invoice123"
          description: "Invoice ID (for invoice transactions)"
        creditCardId:
          type: string
          example: "card123"
          description: "Credit card ID (for credit card transactions)"
        isRecurring:
          type: boolean
          default: false
          example: false
          description: "Whether the transaction is recurring"
        frequency:
          allOf:
            - $ref: '#/components/schemas/TransactionFrequency'
            - nullable: true
          description: "Frequency for recurring transactions (required if isRecurring is true)"
        startDate:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-01-01"
          description: "Start date for recurring transactions (required if isRecurring is true)"
          nullable: true
        endDate:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-12-01"
          description: "End date for recurring transactions (max 1 year from start date)"
          nullable: true
        isPaid:
          type: boolean
          default: false
          example: true
          description: "Whether the transaction has been paid"
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: "BRL"
          description: "Currency code (ISO 4217 format)"
        bankAccountId:
          type: string
          example: "account123"
          description: "Bank account ID where the transaction occurs"
        primaryTransactionId:
          type: string
          example: "transaction123"
          description: "Primary transaction ID (for recurring transaction groups)"
          nullable: true

    Transaction:
      type: object
      properties:
        id:
          type: string
          example: "transaction123"
          description: "Unique transaction identifier"
        name:
          type: string
          example: "Salário Janeiro"
          description: "Transaction name"
        category:
          type: string
          example: "Salário"
          description: "Transaction category"
        value:
          type: number
          example: 5000.00
          description: "Transaction value"
        date:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00Z"
          description: "Transaction date"
        type:
          $ref: '#/components/schemas/TransactionType'
        isRecurring:
          type: boolean
          example: false
          description: "Whether the transaction is recurring"
        frequency:
          allOf:
            - $ref: '#/components/schemas/TransactionFrequency'
            - nullable: true
          description: "Frequency for recurring transactions"
        startDate:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00Z"
          description: "Start date for recurring transactions"
          nullable: true
        endDate:
          type: string
          format: date-time
          example: "2024-12-01T00:00:00Z"
          description: "End date for recurring transactions"
          nullable: true
        isPaid:
          type: boolean
          example: true
          description: "Whether the transaction has been paid"
        currency:
          type: string
          example: "BRL"
          description: "Currency code"
        bankAccountId:
          type: string
          example: "account123"
          description: "Bank account ID"
        invoiceId:
          type: string
          example: "invoice123"
          description: "Invoice ID (for invoice transactions)"
          nullable: true
        creditCardId:
          type: string
          example: "card123"
          description: "Credit card ID (for credit card transactions)"
          nullable: true
        primaryTransactionId:
          type: string
          example: "transaction123"
          description: "Primary transaction ID (for recurring transaction groups)"
          nullable: true
    
    PartialTransactionRequestDTO:
      type: object
      description: "Partial transaction data for updates (all fields optional except those specified by endpoint)"
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: "Aluguel Reajustado"
          description: "Transaction name (3-100 characters)"
        category:
          type: string
          minLength: 2
          maxLength: 30
          example: "Moradia"
          description: "Transaction category (2-30 characters)"
        value:
          type: number
          example: 1400.00
          description: "Transaction value (must be finite)"
        date:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-01-15"
          description: "Transaction date (YYYY-MM-DD or ISO format)"
        type:
          $ref: '#/components/schemas/TransactionType'
        invoiceId:
          type: string
          example: "invoice123"
          description: "Invoice ID (for invoice transactions)"
        creditCardId:
          type: string
          example: "card123"
          description: "Credit card ID (for credit card transactions)"
        isRecurring:
          type: boolean
          example: true
          description: "Whether the transaction is recurring"
        frequency:
          allOf:
            - $ref: '#/components/schemas/TransactionFrequency'
            - nullable: true
          description: "Frequency for recurring transactions"
        startDate:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-01-01"
          description: "Start date for recurring transactions"
          nullable: true
        endDate:
          type: string
          pattern: '^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}:\d{2}(\.\d{3})?(Z)?)?$'
          example: "2024-12-01"
          description: "End date for recurring transactions"
          nullable: true
        isPaid:
          type: boolean
          example: false
          description: "Whether the transaction has been paid"
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          example: "BRL"
          description: "Currency code (ISO 4217 format)"
        bankAccountId:
          type: string
          example: "account123"
          description: "Bank account ID where the transaction occurs"
        primaryTransactionId:
          type: string
          example: "transaction123"
          description: "Primary transaction ID (for recurring transaction groups)"
          nullable: true

    CreditCardFlag:
      type: string
      enum:
        - VISA
        - MASTERCARD
        - ELO
        - AMEX
        - OUTRO
      example: "VISA"
      description: "Credit card flag/brand"

    CreditCard:
      type: object
      properties:
        id:
          type: string
          example: "card123"
          description: "Unique credit card identifier"
        name:
          type: string
          example: "Cartão Visa Santander"
          description: "Credit card display name"
        flag:
          $ref: '#/components/schemas/CreditCardFlag'
        closingDay:
          type: integer
          minimum: 1
          maximum: 31
          example: 15
          description: "Day of month when the invoice closes (1-31)"
        dueDate:
          type: integer
          minimum: 1
          maximum: 31
          example: 10
          description: "Day of month when payment is due (1-31)"
        limit:
          type: number
          minimum: 0
          example: 5000.00
          description: "Total credit card limit"
        usedLimit:
          type: number
          minimum: 0
          example: 1500.00
          description: "Currently used credit (reserved by unpaid transactions)"
        bankAccountId:
          type: string
          example: "account123"
          description: "ID of the linked bank account for payments"

    CreditCardRequestDTO:
      type: object
      required:
        - name
        - flag
        - closingDay
        - dueDate
        - limit
        - bankAccountId
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: "Cartão Visa Santander"
          description: "Credit card display name (3-100 characters)"
        flag:
          $ref: '#/components/schemas/CreditCardFlag'
        closingDay:
          type: integer
          minimum: 1
          maximum: 31
          example: 15
          description: "Day of month when the invoice closes (1-31)"
        dueDate:
          type: integer
          minimum: 1
          maximum: 31
          example: 10
          description: "Day of month when payment is due (1-31)"
        limit:
          type: number
          minimum: 0
          example: 5000.00
          description: "Credit card limit (must be >= 0)"
        bankAccountId:
          type: string
          minLength: 1
          example: "account123"
          description: "ID of the linked bank account for payments"

    UpdateCreditCardDTO:
      type: object
      description: "Partial credit card data for updates (all fields optional)"
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
          example: "Cartão Visa Premium"
          description: "Credit card display name (3-100 characters)"
        flag:
          $ref: '#/components/schemas/CreditCardFlag'
        closingDay:
          type: integer
          minimum: 1
          maximum: 31
          example: 20
          description: "Day of month when the invoice closes (1-31)"
        dueDate:
          type: integer
          minimum: 1
          maximum: 31
          example: 15
          description: "Day of month when payment is due (1-31)"
        limit:
          type: number
          minimum: 0
          example: 7500.00
          description: |
            "Credit card limit. When decreased, validates that new limit >= currently used credit.
            When increased, immediately increases available credit for new transactions."
        bankAccountId:
          type: string
          minLength: 1
          example: "account456"
          description: "ID of the linked bank account for payments"

    InvoiceStatus:
      type: string
      enum:
        - OPEN
        - CLOSED
        - PAID
      example: "OPEN"
      description: |
        Invoice status:
        - OPEN: Invoice is still accepting new transactions
        - CLOSED: Invoice is closed, ready for payment
        - PAID: Invoice has been paid

    CreditCardInvoice:
      type: object
      required:
        - id
        - status
        - total
        - month
        - year
      properties:
        id:
          type: string
          example: "invoice123"
          description: "Unique invoice identifier"
        status:
          $ref: '#/components/schemas/InvoiceStatus'
        total:
          type: number
          example: 3500.50
          description: "Total amount owed on this invoice (sum of all transactions)"
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 1
          description: "Invoice month (1-12)"
        year:
          type: integer
          minimum: 2000
          maximum: 2100
          example: 2024
          description: "Invoice year"
        bankAccountId:
          type: string
          example: "account123"
          description: "Bank account used for payment (null if not paid)"
          nullable: true

    UpdateCreditCardInvoiceDTO:
      type: object
      description: "Partial invoice data for updates (all fields optional)"
      properties:
        status:
          $ref: '#/components/schemas/InvoiceStatus'
        total:
          type: number
          example: 4200.00
          description: "Total amount of the invoice"
        month:
          type: integer
          minimum: 1
          maximum: 12
          example: 2
          description: "Invoice month (1-12)"
        year:
          type: integer
          minimum: 2000
          maximum: 2100
          example: 2024
          description: "Invoice year"
        bankAccountId:
          type: string
          example: "account123"
          description: "Bank account used for payment"
          nullable: true

    CategoryRequestDTO:
      type: object
      required:
        - name
        - type
        - icon
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 50
          example: "Alimentação"
          description: "Category name (2-50 characters)"
        type:
          type: string
          enum:
            - INCOME
            - EXPENSE
          example: "EXPENSE"
          description: "Category type (INCOME or EXPENSE)"
        icon:
          type: string
          minLength: 1
          maxLength: 50
          example: "food"
          description: "Icon name (1-50 characters)"

    Category:
      type: object
      properties:
        id:
          type: string
          example: "category123"
          description: "Unique category identifier"
        name:
          type: string
          example: "Alimentação"
          description: "Category name"
        type:
          type: string
          example: "EXPENSE"
          description: "Category type"
        icon:
          type: string
          example: "food"
          description: "Icon name"

    CreateFinancialPlanningRequestDTO:
      type: object
      required:
        - monthlyIncome
        - budgetAmount
        - month
        - categoryAllocations
      properties:
        monthlyIncome:
          type: number
          format: float
          example: 3500
          description: "Monthly income amount"
        budgetAmount:
          type: number
          format: float
          example: 2450
          description: "Budget amount for the month"
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: "2025-08"
          description: "Month in YYYY-MM format"
        categoryAllocations:
          type: array
          items:
            type: object
            required:
              - categoryId
              - value
            properties:
              categoryId:
                type: string
                example: "category123"
                description: "Category ID"
              value:
                type: number
                format: float
                example: 1000
                description: "Allocated amount for this category"

    CopyFinancialPlanningRequestDTO:
      type: object
      required:
        - sourceMonth
        - targetMonth
      properties:
        sourceMonth:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: "2025-07"
          description: "Source month in YYYY-MM format"
        targetMonth:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: "2025-08"
          description: "Target month in YYYY-MM format"
        adjustments:
          type: object
          properties:
            monthlyIncome:
              type: number
              format: float
              example: 3800
              description: "New monthly income amount"
            budgetAmount:
              type: number
              format: float
              example: 2850
              description: "New budget amount"

    GetFinancialPlanningRequestDTO:
      type: object
      required:
        - month
      properties:
        month:
          type: string
          pattern: '^\d{4}-\d{2}$'
          example: "2025-08"
          description: "Month in YYYY-MM format"

    UpdateFinancialPlanningRequestDTO:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          example: "planning123"
          description: "Financial planning ID"
        monthlyIncome:
          type: number
          format: float
          example: 3800
          description: "Monthly income amount"
        budgetAmount:
          type: number
          format: float
          example: 2850
          description: "Budget amount"
        categoryAllocations:
          type: array
          items:
            type: object
            required:
              - categoryId
              - value
            properties:
              categoryId:
                type: string
                example: "category123"
                description: "Category ID"
              value:
                type: number
                format: float
                example: 1200
                description: "Allocated amount for this category"

    DeleteFinancialPlanningRequestDTO:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          example: "planning123"
          description: "Financial planning ID"

    FinancialPlanningWithCategories:
      type: object
      properties:
        id:
          type: string
          example: "planning123"
          description: "Financial planning ID"
        monthlyIncome:
          type: number
          format: float
          example: 3500
          description: "Monthly income amount"
        budgetAmount:
          type: number
          format: float
          example: 2450
          description: "Budget amount for the month"
        allocatedAmount:
          type: number
          format: float
          example: 2400
          description: "Total allocated amount across categories"
        month:
          type: string
          format: date
          example: "2025-08-01"
          description: "Month this plan applies to"
        categoryAllocations:
          type: array
          items:
            type: object
            properties:
              category:
                $ref: '#/components/schemas/Category'
              value:
                type: number
                format: float
                example: 1000
                description: "Allocated amount for this category"
              spent:
                type: number
                format: float
                example: 850.75
                description: "Total amount spent in this category (paid + unpaid)"
              paidSpent:
                type: number
                format: float
                example: 650.25
                description: "Amount already paid in this category"
              unpaidSpent:
                type: number
                format: float
                example: 200.50
                description: "Amount not yet paid in this category"
              remaining:
                type: number
                format: float
                example: 149.25
                description: "Remaining budget for this category"
              percentUsed:
                type: number
                format: float
                example: 85.08
                description: "Percentage of budget used (total)"
              percentPaidUsed:
                type: number
                format: float
                example: 65.03
                description: "Percentage of budget used (paid expenses)"
              percentUnpaidUsed:
                type: number
                format: float
                example: 20.05
                description: "Percentage of budget used (unpaid expenses)"
        totalSpent:
          type: number
          format: float
          example: 1850.75
          description: "Total amount spent across all categories (paid + unpaid)"
        totalPaidSpent:
          type: number
          format: float
          example: 1450.25
          description: "Total amount of paid expenses across all categories"
        totalUnpaidSpent:
          type: number
          format: float
          example: 400.50
          description: "Total amount of unpaid expenses across all categories"
        remainingBudget:
          type: number
          format: float
          example: 599.25
          description: "Remaining budget (budgetAmount - totalSpent)"
        percentUsed:
          type: number
          format: float
          example: 75.54
          description: "Percentage of budget used (totalSpent / budgetAmount * 100)"
        percentPaidUsed:
          type: number
          format: float
          example: 59.19
          description: "Percentage of budget used for paid expenses"
        percentUnpaidUsed:
          type: number
          format: float
          example: 16.35
          description: "Percentage of budget used for unpaid expenses"
        unallocatedAmount:
          type: number
          format: float
          example: 50
          description: "Unallocated budget amount (budgetAmount - allocatedAmount)"
        createdAt:
          type: string
          format: date-time
          example: "2025-08-01T10:30:00Z"
          description: "Creation timestamp"
        updatedAt:
          type: string
          format: date-time
          example: "2025-08-01T10:30:00Z"
          description: "Last update timestamp"

    SuccessResponse:
      type: object
      properties:
        message:
          type: string
          example: "Operation completed successfully"
          description: "Success message in Portuguese"
        data:
          type: object
          description: "Response data (varies by endpoint)"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Validation failed"
          description: "Error message"
        details:
          type: string
          example: "Name must be at least 2 characters long"
          description: "Detailed error information"

  responses:
    ValidationError:
      description: Validation error in request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            validation_error:
              summary: Validation failed
              value:
                error: "Validation failed"
                details: "Name must be at least 2 characters long"

    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            unauthorized:
              summary: User not authenticated
              value:
                error: "Usuário não autenticado"
                details: "Valid authentication token required"

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            not_found:
              summary: User not found
              value:
                error: "Usuário não encontrado"
                details: "The requested user does not exist"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            server_error:
              summary: Server error
              value:
                error: "Erro interno do servidor"
                details: "An unexpected error occurred"
    
    CreditLimitExceededError:
      description: Credit limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            limit_exceeded:
              summary: Transaction exceeds available credit
              value:
                error: "Credit limit exceeded. Available: 1500.00, Requested: 2000.00"
            installment_exceeds_limit:
              summary: Installment series exceeds available credit
              value:
                error: "Installment series exceeds available limit. Need: 3000.00, Available: 2500.00"

  securitySchemes:
    FirebaseAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        Firebase Authentication JWT token.

        **How to get a token:**
        1. Use the Authentication endpoint above to sign in
        2. Copy the `idToken` from the response
        3. Click "Authorize" button and enter: `Bearer <idToken>`

        **Example:**

